<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="edge" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <link rel="icon" href="/_ashen.ico" type="image/x-icon" />
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0"/>
    <title>反身而诚-收藏</title>
    <meta name="keywords" content="反身而诚,小游戏,相册,留言">
    <meta name="description" content="反身而诚的个人空间网站,相册,留言">
    <link rel="stylesheet" href="../css/main.css" />
	<style>
        html,body{width:100%; height:100%; font-family:"Microsoft YaHei","SimSun";}
        body{background:#efefef url(../src/index/_img/paper-bg.jpg) repeat;}
        #content{position:static;overflow-y:auto; height:100%; background:transparent!important;}
        #player{bottom:410px;}
		.hide{display:none!important;}
        .fl{float:left;}
        .fr{float:right;}

        @font-face {font-family: "iconfont";
            src: url('iconfont.eot?t=1617950646193'); /* IE9 */
            src: url('iconfont.eot?t=1617950646193#iefix') format('embedded-opentype'), /* IE6-IE8 */
            url('data:application/x-font-woff2;charset=utf-8;base64,d09GMgABAAAAAAMgAAsAAAAABywAAALTAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHEIGVgCDBgqCCIFwATYCJAMMCwgABCAFhG0HQRtBBsgusG3YkxK1sRACFHErDA8wFsHTfrR5u3simkzSXROtltRI2gmJBK0RIcSTiiUv4f/vWvZLrAiiisALyXQ62Gy2CGqFbiUQPY90J9zJc9QTgMzp8tOSJoEByn3i3mnTEpjPG45rLRrLPnVpFgcU0FibIiuQLkHtIV4NF3GYQKNRYcy2C8rqwFZhjQrES57TgG0upChCtl6orVlYxEc16tP7FIAP4efjP8SELUlNZk3cf5Gvh6xfcb9kqwlnPol4PgeEZWTMAYW4qHUdsYhTcyw0agpLvRLUKkKaK1r9JxTpilr7D48kiFpWfjOYIunEr1xRqoaSuz4og1rUYQe4YDG68WSl296sy+76d3v3PiZegu+XTaHc6mQIWXm1bzp4nHw2PU48xMWwc9vPp7nH+Kb6RodPz/55/kldWJlcNS1PLNVHm9mTOVFv+zN4ou1mdPSr7Mu977z8jFd/twUEd2Wo9dX2vRNg6dZ77fq8ZefzL0+yKql/nLfudL5nyjoNgQaHgB3gCqCSUZEVktd4//Dv6N1xHe50Wf5d71DA1/sPMFgp0D9HvYQg/r3injVFl1rmXFSRKzLd2UImIIEFjaiyfJ1+jtf1vEIm1OtJkdQZQVZvjFzoc6jRZBG16q2h0azC5U26UBaiNGDGLCC020TS6jOydjfkQv+BGr1+oVZ7WKDRQXRt2GQiePstijUM65F2EPE6RSaOldlHhTWYM4oampWGzAZMDXwURUdEFbOFWMZ0jimGPi6GMYIIVSRUAMdhUVSQSpUerGMR3YypKZGRpO5FETpFAntbKEyDwfQQrUEIT0chI35zxr70/hoYx0ikQVsINeEGGGXAt49EixDVg1yoknsR7uUZgz6cGAxDIASlkCAF4MBEO6VA1Pp+PTAdJkL3iIQqRSSpR/qqItbXSN+3BRpZE3KkyFHU3/AapdftJju+5WVONMrhUsYIAAA=') format('woff2'),
            url('iconfont.woff?t=1617950646193') format('woff'),
            url('iconfont.ttf?t=1617950646193') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+ */
            url('iconfont.svg?t=1617950646193#iconfont') format('svg'); /* iOS 4.1- */
        }

        .iconfont {
            font-family: "iconfont" !important;
            font-size: 16px;
            font-style: normal;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .icon-tab:before {content: "\e69f";}
        .icon-pl:before {content: "\e634";}
		
		.df{display:-webkit-box; display: -webkit-flex;	display:flex; flex-flow:row;}
		.df-c{-webkit-box-orient:vertical; -webkit-flex-flow:column; flex-flow:column;}
		.fc,.f1{-webkit-box-flex:1; -webkit-flex:1; flex:1;}
		.ai-s{align-items:flex-start;}
		.ai-c{align-items:center;}
		.ai-e{align-items:flex-end;}
		.just-c-sta{justify-content: start;}
		.just-c-end{justify-content: flex-end;}
		.just-c-bet{justify-content:space-between;}
		.just-c-ct{justify-content:center;}
		.just-c-aro{justify-content:space-around;}
		.df-w-w{flex-wrap:wrap; align-content:flex-start}
		.one-hide{display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:1; overflow:hidden; text-overflow:ellipsis;}
		.two-hide{display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2; overflow:hidden; text-overflow:ellipsis;}
		.three-hide{display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:3; overflow:hidden; text-overflow:ellipsis;}

        .tree{position:fixed; opacity:0.6; left:0; bottom:0; width:460px; height:460px; background:url(../src/index/_img/tree.png) no-repeat left bottom; background-size:460px;}
        #box{position:relative; width:980px; padding-left:100px; margin:0 auto; z-index:3;}
        #box .list{width:680px; padding-top:30px; margin-right:40px;}
        #box .tabbox{width:260px; height:400px; padding-top:30px;}
        #box .ul .item{padding:20px 0; height:90px; border-top:1px solid #aaaaaa; cursor:pointer; color:inherit; }
        #box .ul .item:last-child{border-bottom:1px solid #aaaaaa;}
        #box .ul .item:hover .title{color:#0088bb;}
        #box .ul .item .title{height:52px; line-height:26px; font-size:20px; }
        #box .ul .item .img{width:117px; height:88px; border-radius:4px; margin-left:20px; background-size:cover; background-position:center; background-image:url(../src/index/_img/nocover.jpg)}
        #box .ul .item .dtl{margin-top:18px; height:20px;}
        #box .ul .item .dtl .time{font-size:14px; color:#888888; margin-right:20px;}
        #box .ul .item .dtl .iconfont{color:#99a2aa; margin-right:30px;}
        #box .ul .item .dtl .iconfont:before{margin-right:6px; font-size:18px;}
        #box .ul .item .dtl .iconfont:last-child{margin-right:0;}
        #box .ul .item .dtl .tab span{display:inline-block; padding:0 5px; margin-right:4px; font-size:12px; line-height:20px; vertical-align:top; background:#b0b0b0; color:#ffffff; border-radius:2px;}
        #box .ul .nodata{text-align:center; padding:30px; font-size:18px; color:#999999;}

        #box .pagesbox{margin-top:40px; width:100%;height:30px; text-align:center; user-select:none;}
        #box .pagesbox a{line-height: 30px;margin: 0 8px;background: #ffffff;padding: 5px 12px;cursor:pointer;vertical-align: middle;}
        #box .pagesbox a:hover{outline:2px solid #000000;}
        #box .pagesbox .active{background:#000000;color:#ffffff;}
        #box .pagesbox span{line-height:30px;padding: 5px 12px;cursor: pointer;vertical-align: middle;font-size:12px;color: #666;}
        #box .loading{opacity:0.5;}

        .searchbox{height:34px; box-sizing:border-box; border:1px solid #999; border-radius:4px; background:rgba(255,255,255,0.3);}
        .searchbox .input{border:none; outline:none; background:transparent; box-sizing:border-box; height:32px; width:220px; padding-left:10px; color:#666;}
        .searchbox .searchbtn{border:none; outline:none; padding:0; width:34px; height:32px; background:transparent url(../src/index/_img/search.png) no-repeat center center; background-size:60% 60%; cursor:pointer;}

        .seltabbox{margin-top:30px;}
        .seltabbox .title{font-size:20px; padding:10px 0; border-bottom:1px solid #999999;}
        .seltabbox .seltab{padding-top:10px;}
        .seltabbox .seltab .lb{height:28px; line-height:28px; margin:0 10px 10px 0; padding:0 12px; border-radius:16px; border:thin solid #999999; cursor:pointer;}
        .seltabbox .seltab .lb:hover{background:rgba(0,0,0,0.1);}
        .seltabbox .seltab .lb.active{background:#0088bb; border-color:#0088bb; color:#ffffff;}

        .nav{margin-top:20px; padding:10px 0; font-size:18px;}
        .nav span{cursor:pointer;}
        .nav span:after{content:"〉"; color:#999999; padding:0 4px;}
        .nav span:hover{color:#0088bb;}
        .nav span:last-child:after{display:none;}
        
        .banner{box-sizing:border-box; display:block; padding:20px 80px 20px 100px; height:134px; background:#ffffff url(../src/index/_img/banner.jpg) no-repeat; background-size:cover; border-radius:6px;}
    </style>
</head>
<body>
    <div class="menus">
        <img src="../src/public/public/mn-0.png" class="menu" />
        <div class="ls">
            <a class="mn mn1" href="/essay" title="滥觞"><img src="../src/public/public/mn-4.png" class="img" /></a>
            <a class="mn mn2" href="/album" title="相册"><img src="../src/public/public/mn-2.png" class="img" /></a>
            <a class="mn mn3" href="/notes" title="树洞"><img src="../src/public/public/mn-3.png" class="img" /></a>
        </div>
    </div>
    <div id="content">
        <div id="box" class="df">
            <div class="list">
                <a class="banner" href="/pages/essay_create.html" target="_blank"></a>
                <div id="nav" class="nav df ai-c">
                    <span class="all">全部文章</span>
                </div>
                <div id="ul" class="ul"></div>
                <div class="pagesbox"></div>
            </div>
            <div class="tabbox">
                <form id="searchfrom" class="searchbox df ai-c just-c-bet">
                    <input class="input" maxlength="12" type="text" placeholder="搜索文章" />
                    <button class="searchbtn"></button>
                </form>
                <div class="seltabbox">
                    <div class="title">选择标签</div>
                    <div id="seltab" class="seltab df df-w-w"></div>
                </div>
            </div>
        </div>
        <div class="tree"></div>
    </div>
	<div id="toast" class="toast"></div>
<script type="text/javascript" src="../js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript">
var ul = $("#ul");
var nav = $("#nav");
var seltab = $("#seltab");
var pagesDom = $("#box>.list>.pagesbox");
var labelObj = {};
var lbsc = '';
var limit = 32;

$(function(){
	setEvent();
    init();
	getData();
});

function setEvent(){
    pagesDom.on("click","a",function(){
        var ts = $(this);
        if(ts.hasClass("loading")){return false;}
        var atPage = ts.data("goto");
        ts.addClass("loading");
        getData(atPage,function(b){
            ts.removeClass("loading").addClass("active");
        });
    });
    $("#searchfrom").submit(function(){
        lbsc = '';
        $("#seltab .lb.active").removeClass("active");
        getData(0);
        if(nav.find(".sub").length){nav.find(".sub").remove();}
        nav.append('<span class="sub">“'+ $(this).find(".input").val() +'”</span>');
        return false;
    });
    $("#seltab").on("click",".lb", function(){
        var ts = $(this);
        ts.siblings(".active").removeClass("active");
        ts.addClass("active");
        var id = ts.data('id');
        $("#searchfrom .input").val('');
        lbsc = id;
        getData(0);
        if(nav.find(".sub").length){nav.find(".sub").remove();}
        nav.append('<span class="sub">分类：'+ts.html()+'</span>');
    });
    $("#nav .all").click(function(){
        lbsc = '';
        $("#seltab .lb.active").removeClass("active");
        $("#searchfrom .input").val('');
        getData(0);
        if(nav.find(".sub").length){nav.find(".sub").remove();}
    });
}

function init(){
    $.ajax({
        url: "/phps/article/getLabels.php",
        dataType: "json",
        success(data){
            if(data && data.arr && data.arr.length){
                seltab.empty();
                for(var i in data.arr){
                    var o = data.arr[i];
                    seltab.append('<span class="lb" data-id="'+ o.id +'">'+ o.text +'</span>');
                    labelObj[o.id] = o.text;
                }
            }
        }
    });
}

function getData(page, callback){
    var search = $("#searchfrom .input").val();
    $.ajax({
        url: "/phps/article/search.php",
        type: "get",
        dataType: "json",
        data: {search:search, label:lbsc, page:page||0, limit:limit},
        success(data){
            ul.empty();
            if(data.arr && data.arr.length){
                for(var i in data.arr){
                    var o = data.arr[i];
                    var lbspan = "";
                    for(var lb in o.label){
                        if(labelText(o.label[lb])){
                            lbspan += '<span>'+ labelText(o.label[lb]) +'</span>';
                        }
                    }
                    ul.append('<a href="/essay_detail?id='+ o.id +'" target="_blandk" class="item df">'+
                        '<div class="f1">'+
                            '<div class="title two-hide">'+ o.title +'</div>'+
                            '<div class="dtl df">'+
                                '<div class="time">'+ o.addtime +'</div>'+
                                '<div class="iconfont icon-tab tab one-hide">'+ lbspan +'</div>'+
                            '</div>'+
                        '</div>'+
                        '<div class="img" '+ (o.cover?'style="background-image:url('+ o.cover +')"':'') +'></div>'+
                    '</a>');
                }
                pagesDom.html("");
                setPageButton(page||0, data.pages, Number(data.len));
            }else{
                pagesDom.html("");
                setPageButton(0, 0, 0);
                ul.html('<li class="nodata">暂无数据</li>');
            }
            callback && callback()
        },
        error(){toast("请求失败")}
    });
}

function labelText(id){return labelObj[id] || false;}

function setPageButton(page,pages,len){
    if(len<=limit){return}
    if(pages<10){
        for(var i=0;i<pages;i++){
            pagesDom.append("<a "+(i==page?"class='active'":"")+" data-goto='"+i+"'>"+(i+1)+"</a>");
        }
    }else{
        for(var i=0; i<7; i++){
            if(page<=3){
                pagesDom.append("<a "+(page==i?"class='active'":"")+" data-goto='"+i+"'>"+(i+1)+"</a>");
            }else if(page+4>=pages){
                pagesDom.append("<a "+(page==(pages-7+i)?"class='active'":"")+" data-goto='"+(pages-7+i)+"'>"+(pages-6+i)+"</a>");
            }else{
                pagesDom.append("<a "+(i==3?"class='active'":"")+" data-goto='"+(page-3+i)+"'>"+(page-3+i+1)+"</a>");
            }
        }
    }
    pagesDom.append("<span>共 "+pages+" 页 "+len+" 条</span>").find("a.active");
}

</script>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1273638543'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s13.cnzz.com/z_stat.php%3Fid%3D1273638543%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</body>
</html>
